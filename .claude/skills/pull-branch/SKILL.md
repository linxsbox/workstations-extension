---
name: pull-branch
description: 拉取并更新分支代码，使用 git-retry.sh 处理网络不稳定问题。当用户说"拉取代码"、"更新分支"、"pull"、"同步代码"时使用此技能。
---

# Pull Branch

拉取并更新分支代码，使用 git-retry.sh 处理网络不稳定问题。

## Usage

当用户说以下内容时触发：
- "拉取代码"
- "更新分支"
- "pull"
- "同步代码"
- "更新主分支"
- "更新当前分支"

## Implementation

### 步骤 1: 检查当前分支

```bash
git branch --show-current
```

获取当前所在分支名称。

### 步骤 2: 确定目标分支

- 如果用户明确指定了分支名（如 "更新主分支"、"拉取 main"）→ 使用指定的分支
- 如果用户没有指定分支 → 使用当前分支

常见的主分支名称：
- `main`
- `master`

### 步骤 3: 切换到目标分支（如果需要）

如果目标分支不是当前分支：

```bash
git checkout <目标分支>
```

### 步骤 4: 拉取远程更新

```bash
./.claude/scripts/git-retry.sh pull origin <目标分支>
```

使用 git-retry.sh 自动处理网络问题（最多重试 10 次）。

### 步骤 5: 显示更新结果

执行成功后，显示：
- 更新的文件数量
- 新增/修改/删除的行数
- 是否有冲突需要解决

## Safety Checks

### 必须的检查
- 确保工作区是干净的（没有未提交的更改）
- 如果有未提交的更改，提示用户先提交或暂存
- 使用 git-retry.sh 进行拉取操作

## Error Handling

### 有未提交的更改
提示用户：
```
检测到未提交的更改，请先：
1. 提交更改：git add . && git commit -m "message"
2. 或暂存更改：git stash
```
终止流程。

### 分支不存在
如果目标分支不存在，提示用户检查分支名称，终止流程。

### 拉取冲突
如果拉取时出现冲突：
1. 显示冲突的文件列表
2. 提示用户手动解决冲突
3. 提供解决冲突的步骤：
   - 编辑冲突文件
   - `git add <文件>`
   - `git commit`

### 网络失败
git-retry.sh 会自动重试，如果 10 次都失败：
- 显示错误信息
- 提示用户检查网络连接
- 建议稍后重试

## Notes

- 使用 .claude/scripts/git-retry.sh 脚本处理网络不稳定问题
- 每次拉取最多重试 10 次，间隔 20 秒
- 拉取前确保工作区干净，避免冲突
- 如果是主分支，建议定期拉取保持同步
